# ðŸ“‘ 1.2 â€” DÃ©clencheurs (`on`)

Dans GitHub Actions, la clÃ© `on:` dÃ©finit **quand** un workflow doit Ãªtre exÃ©cutÃ©.
Voici le bloc utilisÃ© dans `deploy-sentinel-monitoring.yml` :

```yaml
on:
  workflow_dispatch: {}                  # manuel
  push:                                  # auto -> dossier ciblÃ© change
    branches: [ main ]
    paths:
      - 'sentinel/**'
      - '.github/workflows/deploy-sentinel-monitoring.yml'
```

---

## ðŸ”¹ `workflow_dispatch`

* Permet de dÃ©clencher le workflow **manuellement** depuis lâ€™onglet **Actions** sur GitHub.
* TrÃ¨s utile pour :

    * Forcer un redÃ©ploiement mÃªme si aucun fichier nâ€™a changÃ©.
    * DÃ©boguer le pipeline pas Ã  pas.
    * Tester de nouvelles configurations sans push.

ðŸ‘‰ En pratique : dans lâ€™UI GitHub â†’ **Actions** â†’ choisir le workflow â†’ **Run workflow**.

---

## ðŸ”¹ `push`

Ce dÃ©clencheur exÃ©cute le workflow automatiquement lorsquâ€™il y a un **push** sur le repo.

### `branches: [ main ]`

* Restreint le dÃ©clencheur aux **commits sur la branche `main`**.
* Ã‰vite les dÃ©ploiements non voulus depuis des branches de dev/feature.
* En cas de besoin, on peut Ã©largir (ex : `branches: [ main, staging ]`).

### `paths:`

* Restreint encore plus le dÃ©clenchement :

    * `sentinel/**` â†’ uniquement si un fichier dans le dossier `sentinel/` est modifiÃ©.
    * `.github/workflows/deploy-sentinel-monitoring.yml` â†’ aussi si on modifie le workflow lui-mÃªme.

ðŸ‘‰ Ã‡a permet dâ€™Ã©viter un redeploy inutile quand on modifie par exemple juste un `README.md` ou de la doc hors `sentinel/`.

---

## âœ… RÃ©sumÃ© pratique

* **DÃ©ploiement manuel** possible Ã  tout moment (via `workflow_dispatch`).
* **DÃ©ploiement auto** uniquement quand :

    * Tu modifies une config du dossier `sentinel/` (compose, Prometheus, Grafana, Loki, Fluent Bit, etc.).
    * Tu modifies le fichier du workflow `deploy-sentinel-monitoring.yml`.

Cela garantit que :

* La prod nâ€™est jamais polluÃ©e par un commit hors `main`.
* Tu ne dÃ©ploies que si câ€™est vraiment liÃ© Ã  Sentinel.

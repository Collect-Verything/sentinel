# 📑 3.0 — Secrets & Variables requis (GitHub Actions)

Dans GitHub Actions, on utilise **deux mécanismes complémentaires** pour passer des informations à nos workflows : les **Secrets** 🔑 et les **Variables** 📦.
Ils se ressemblent mais **n’ont pas le même rôle** ni la même portée.

---

## 🔑 Secrets (sécurisés)

### Définition

* Contiennent des **données sensibles** : mots de passe, clés privées SSH, tokens API, etc.
* **Chiffrés par GitHub** → ils ne sont jamais affichés en clair dans les logs.

### Visibilité

* ❌ **Jamais visibles en public** (même dans les forks).
* ✅ Disponibles uniquement aux **workflows du repo** où ils sont définis.

### Utilisation

```yaml
with:
  password: ${{ secrets.SSH_PASSWORD }}
```

### Points importants

* Masqués dans les logs (`***`).
* Ne peuvent **pas être lus directement** dans un script (juste injectés).
* Portée : repo, organisation, ou environnement (prod/staging).

---

## 📦 Variables (non sensibles)

### Définition

* Contiennent des **valeurs de configuration** non sensibles : noms d’hôtes, utilisateurs, flags, constantes.
* Exemple : `SSH_HOST=82.165.92.40`, `SSH_USER=root`.

### Visibilité

* ✅ **Lisibles en clair** dans l’interface GitHub.
* ⚠️ Donc **ne jamais y stocker un secret** (mot de passe, clé).

### Utilisation

```yaml
with:
  host: ${{ vars.SSH_HOST }}
  username: ${{ vars.SSH_USER }}
```

### Points importants

* Pratiques pour **ne pas hardcoder** dans les workflows.
* Peuvent être définies au **repo**, **org**, ou **environnement**.
* Peuvent être utilisées aussi dans les jobs/env (`env:`).

---

## 🧩 Différences clés

| Aspect              | **Secrets** 🔑                     | **Variables** 📦            |
| ------------------- | ---------------------------------- | --------------------------- |
| **Usage**           | Infos sensibles (pwd, token…)      | Infos non sensibles (host…) |
| **Visibilité**      | Jamais affichés                    | Lisibles en clair           |
| **Masquage logs**   | Oui (`***`)                        | Non                         |
| **Exemple typique** | `SSH_PASSWORD`, `GF_SMTP_PASSWORD` | `SSH_HOST`, `SSH_USER`      |

---

## ⚙️ Intégration dans la VM (runner)

* Lorsqu’un workflow démarre, GitHub injecte automatiquement **secrets** et **variables** dans l’environnement du runner.
* Ils deviennent accessibles via la syntaxe :

    * `${{ secrets.MA_VARIABLE }}`
    * `${{ vars.MA_VARIABLE }}`

Exemple d’injection dans un script :

```yaml
- name: Exemple d’utilisation
  run: |
    echo "Hôte: ${{ vars.SSH_HOST }}"
    echo "User: ${{ vars.SSH_USER }}"
    echo "Password: ${{ secrets.SSH_PASSWORD }}" # masqué dans logs
```

---

## ✅ Bonnes pratiques

* **Secrets** → uniquement pour les données critiques (tokens, mots de passe, clés privées).
* **Variables** → pour les constantes de config réutilisables (IP serveur, ports, users).
* Toujours **éviter le hardcoding** dans les YAML.
* Si une valeur est utilisée par plusieurs workflows → la mettre en **Org-level**.
* Pour les environnements (`staging`, `prod`), séparer **Secrets/Vars par environnement**.

---

## ⚠️ Points à ne pas oublier

* Les secrets ne sont **pas accessibles aux PRs venant d’un fork** (sécurité GitHub).
* Si tu veux exposer un secret comme variable d’environnement dans un step :

  ```yaml
  env:
    SMTP_PASS: ${{ secrets.GF_SMTP_PASSWORD }}
  run: echo "Using secret safely"
  ```
* Attention : une variable mal utilisée peut **fuiter dans les logs** → vérifier avec `masking`.

---

👉 TL;DR :

* **Secrets** = sensibles, masqués, protégés → 🔑 mots de passe, clés.
* **Variables** = non sensibles, visibles, pratiques → 📦 host, user, configs.
* Les deux sont injectés automatiquement dans la VM et utilisés via `${{ secrets.X }}` et `${{ vars.X }}`.

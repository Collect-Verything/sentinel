# ğŸ“‘ 4.1 â€” Installation de `sshpass` sur le runner

## ğŸ¯ Objectif

Cette Ã©tape installe lâ€™outil **`sshpass`** dans le **runner GitHub Actions** (la machine Ã©phÃ©mÃ¨re qui exÃ©cute le workflow).
ğŸ‘‰ Câ€™est une dÃ©pendance essentielle car notre pipeline utilise **`rsync`** avec une connexion SSH basÃ©e sur **mot de passe** (pas de clÃ© SSH).

---

## ğŸ”¹ Ã‰tape dans le workflow

```yaml
- name: Install sshpass on runner (for rsync over password SSH)
  run: sudo apt-get update && sudo apt-get install -y sshpass
```

* `apt-get update` â†’ met Ã  jour la liste des paquets.
* `apt-get install -y sshpass` â†’ installe lâ€™outil `sshpass`.

---

## ğŸ”¹ RÃ´le de `sshpass`

Par dÃ©faut :

* `ssh` et `rsync` attendent un **mot de passe entrÃ© Ã  la main** (mode interactif).
* Dans un workflow automatisÃ©, on ne peut pas taper le mot de passe manuellement.

ğŸ‘‰ `sshpass` permet de **fournir un mot de passe Ã  `ssh` ou `rsync` de maniÃ¨re non interactive**, via :

* une variable dâ€™environnement (`SSHPASS=...`)
* ou un fichier texte contenant le mot de passe.

Exemple concret dans notre pipeline :

```bash
sshpass -e rsync -az --delete \
  -e "ssh -p 22 -o StrictHostKeyChecking=no" \
  sentinel/ root@82.165.92.40:/root/sentinel/
```

Ici :

* `sshpass -e` â†’ prend le mot de passe depuis la variable dâ€™environnement `SSHPASS` (sÃ©curisÃ©e via GitHub Secrets).
* `rsync` â†’ fait la copie des fichiers **sans jamais demander le mot de passe Ã  lâ€™utilisateur**.

---

## ğŸ”¹ Points importants & limites

1. **SÃ©curitÃ©** ğŸ”’

    * Lâ€™utilisation de `sshpass` est **moins sÃ©curisÃ©e** que les clÃ©s SSH, car le mot de passe circule en mÃ©moire.
    * Mais dans notre cas, câ€™est un compromis simple et rapide.
    * IdÃ©alement â†’ migrer plus tard vers **clÃ© SSH + agent**.

2. **PortabilitÃ©** âš¡

    * `sshpass` est disponible sur Linux (installÃ© via APT dans nos runners Ubuntu).
    * Pas nÃ©cessaire dâ€™installer manuellement sur le serveur, seulement sur le runner GitHub Actions.

3. **Usage typique**

    * DÃ©ploiements automatisÃ©s simples (comme le nÃ´tre).
    * Cas oÃ¹ on ne peut pas utiliser de clÃ© SSH (fournisseur ou contraintes).

---

## âœ… En rÃ©sumÃ©

* `sshpass` permet Ã  `ssh` et `rsync` dâ€™utiliser un mot de passe **sans interaction humaine**.
* On lâ€™installe sur le **runner GitHub Actions**, pas sur le serveur.
* Dans notre pipeline, il est indispensable pour lâ€™Ã©tape **rsync** (copie du repo vers `/root/sentinel`).
* Câ€™est pratique pour dÃ©buter, mais Ã  terme on migrera vers une **authentification par clÃ© SSH** pour plus de sÃ©curitÃ©.

# ğŸ“‘ 4.3 â€” Checkout repo

## ğŸ¯ Objectif

Cette Ã©tape permet de **rÃ©cupÃ©rer le code source du dÃ©pÃ´t GitHub** (le repository Sentinel) dans lâ€™environnement du runner GitHub Actions.
ğŸ‘‰ Sans cette Ã©tape, le workflow **ne connaÃ®t pas le contenu du repo** (donc pas de `docker-compose.yml`, ni de configs, ni de docs Ã  copier sur le serveur).
Documentation : https://github.com/actions/checkout

---

## ğŸ”¹ Ã‰tape dans le workflow

```yaml
- name: Checkout repo
  uses: actions/checkout@v4
```

---

## ğŸ”¹ DÃ©composition

* **`uses: actions/checkout@v4`**

    * Action officielle maintenue par GitHub.
    * TÃ©lÃ©charge automatiquement le **code du dÃ©pÃ´t liÃ© au workflow** dans le runner (`ubuntu-latest`).
    * Par dÃ©faut â†’ clone la branche sur laquelle le workflow a Ã©tÃ© dÃ©clenchÃ© (ex. `main`).

* **Comportement par dÃ©faut :**

    * Clone en **profondeur 1** (`--depth=1`) â†’ seul le dernier commit est tÃ©lÃ©chargÃ© â†’ rapide.
    * Place le repo dans le **dossier de travail** `/home/runner/work/<repo>/<repo>` sur le runner.
    * Si le repo sâ€™appelle `sentinel`, on aura :

      ```
      /home/runner/work/sentinel/sentinel/
      ```

---

## ğŸ”¹ Pourquoi est-ce nÃ©cessaire ?

1. **AccÃ©der aux fichiers**

    * Tous nos fichiers de config (`docker-compose.yml`, `grafana/`, `prometheus.yml`, etc.) sont dans le repo.
    * Sans `checkout`, le workflow **nâ€™a aucun fichier** â†’ `rsync` Ã©chouerait.

2. **CohÃ©rence avec le commit dÃ©clencheur**

    * Ce qui est dÃ©ployÃ© correspond **exactement** au code de la branche (`main`).
    * Pas de dÃ©calage entre ce quâ€™on voit sur GitHub et ce qui tourne sur le serveur.

3. **CompatibilitÃ© CI/CD**

    * Presque **tous les workflows GitHub Actions** commencent par `actions/checkout`.
    * Câ€™est la maniÃ¨re standard de travailler sur le code dâ€™un repo.

---

## ğŸ”¹ Options utiles

On peut personnaliser `actions/checkout` :

* **`with: fetch-depth: 0`** â†’ clone complet (utile si besoin de lâ€™historique Git).
* **`with: ref: my-branch`** â†’ forcer une branche/commit/tag spÃ©cifique.
* **`with: path: ./subdir`** â†’ cloner dans un autre chemin.

Exemple :

```yaml
- name: Checkout repo complet
  uses: actions/checkout@v4
  with:
    fetch-depth: 0
```

---

## ğŸ”¹ Points intÃ©ressants

* Le **rÃ©pertoire du repo** est disponible uniquement dans le runner (temporaire).
* On doit donc utiliser `rsync` pour **copier les fichiers sur le serveur** si on veut les persister.
* Les runners GitHub sont dÃ©truits aprÃ¨s chaque exÃ©cution â†’ pas de persistance locale.

---

## âœ… En rÃ©sumÃ©

* **But :** rendre accessible le contenu du repo dans le workflow.
* **Action clÃ© :** `actions/checkout@v4`.
* **Pourquoi :** sans Ã§a, pas de fichiers Ã  dÃ©ployer.
* **RÃ©sultat :** le code du repo est disponible dans `/home/runner/work/...`.
* **Bonnes pratiques :** presque indispensable dans tout workflow CI/CD.
